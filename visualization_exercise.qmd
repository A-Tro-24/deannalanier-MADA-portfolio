---
title: "Visualization Exercise"
output:
  html_document:
    toc: FALSE
---

# Data Source 

This data set contains the deaths involving COVID-19, pneumonia, and
influenza reported to NCHS by sex, age group, and jurisdiction. This data was obtained from the [Centers for Disease Control and
Prevention (CDC)'s National Center for Health Statistics
(NCHS)](https://data.cdc.gov/NCHS/Provisional-COVID-19-Deaths-by-Sex-and-Age/9bhg-hcku).

I decided to recreate some of my figures from last week as interactive graphs.



## Load Libraries

```{r echo = FALSE}
# Load Libraries
library(here)
library(plotly)
library(tidyverse)
```


## Read in .rds file

```{r}
data_location=here("dataanalysis-exercise","output","clean_data.rds")
processedData = readRDS(data_location)
```


## Plot static

Bar plot of the COVID_19 deaths, Pneumonia Deaths, and Influenza Deaths between 2020 - 2021 

```{r}

dfm = processedData %>% pivot_longer(cols=c('COVID_19_Deaths','Pneumonia_Deaths','Influenza_Deaths'),
                    names_to="variable",
                    values_to="value")
year_plot = ggplot(dfm,aes(x = Year,y = value)) + 
    geom_bar(aes(fill = variable),stat = "identity",position = "dodge")+theme(legend.position = "bottom",legend.key.width= unit(0.1, 'cm'), legend.title= element_blank(),axis.text.x=element_text(size=9))

#age_plot = ggplot(dfm,aes(x = Age_Group,y = value)) + 
#    geom_bar(aes(fill = variable),stat = "identity",position = "dodge")+theme(legend.position="none",axis.text.x = element_text(size = #10, angle=60, hjust=1))


year_plot
#age_plot
```
## Plot 1 interactive 

```{r}
data_plot = processedData %>% filter(Group == "By Year")
```

```{r}
#Create list for each of the variable that we want to separate as differnt buttons 

COVID_19_Deaths = list(
  x=processedData$Year, 
  y=processedData$COVID_19_Deaths,
  xref='x', yref='y'
)

Pneumonia_Deaths = list(
  x=processedData$Year, 
  y=processedData$Pneumonia_Deaths,
  xref='x', yref='y'
)

Influenza_Deaths = list(
  x=processedData$Year, 
  y=processedData$Influenza_Deaths,
  xref='x', yref='y'
)

```

```{r}
updatemenus <- list(
  list(
    active = 0,
    type= 'buttons',
    direction = "right",
    xanchor = 'right',
    yanchor = "bottom",
    pad = list('r'= 0, 't'= 0, 'b' = 0),
    x = 0.5,
    y = 1.15,
    buttons = list(
      list(
        label = "COVID-19",
        method = "update",
        args = list(list(visible = c(TRUE, FALSE, FALSE)),
                    list(title = "Covid-19 Related Deaths",
                         annotations = list(c(), c(), COVID_19_Deaths)))),
      list(
        label = "Pneumonia",
        method = "update",
        args = list(list(visible = c(FALSE, TRUE, FALSE)),
                    list(title = "Pneumonia Related Deaths ",
                         annotations = list( c(), Pneumonia_Deaths, c())))),
      list(
        label = "Influenza",
        method = "update",
        args = list(list(visible = c(FALSE, FALSE, TRUE)),
                    list(title = "Influenza Related Deaths",
                         annotations = list(Influenza_Deaths, c(), c())))),
      list(
        label = "Reset",
        method = "update",
        args = list(list(visible = c(TRUE, TRUE, TRUE)),
                    list(title = "All Respiratory Virus Related Deaths",
                         annotations = list(c(), c(), c())))))
  )
)


fig = plot_ly(processedData, x = ~Year, y = ~COVID_19_Deaths, type = 'bar', name = 'Covid-19 Deaths')
fig = fig %>% add_trace(y = ~Pneumonia_Deaths, name = 'Pneumonia Deaths')
fig = fig %>% add_trace(y = ~Influenza_Deaths, name = 'Flu Deaths')
fig = fig %>% layout(title = list(text='All Respiratory Virus Related Deaths', y = 0.95, x = 0.5, xanchor = 'left', yanchor =  'bottom'),yaxis = list(title = 'Count'), barmode = 'group',xaxis = list(title = "Year"),updatemenus=updatemenus)

fig
```

